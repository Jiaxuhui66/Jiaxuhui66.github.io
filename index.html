<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>点餐系统</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            margin: 20px;
            /* background-color: rgb(234, 173, 173); */
            
        }

        #sidebar {
            width: 150px;
            height: 1000px;
            /* background-color: #f4e4e4; */
            color: white;
            padding: 10px;
        }

        #content {
            flex-grow: 1;
            margin-left: 20px;
        }

        h1 {
            text-align: center;
        }

        .menu-item {
            background-color: #fff;
            border: 1px solid #000000;
            padding: 10px;
            margin: 10px;
            display: flex;
            justify-content: space-between;
        }

        .cart-item, .order-item {
            background-color: #fff;
            border: 1px solid #d33333;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px;
            display: flex;
            justify-content: space-between;
        }

        .checkout-btn {
            margin-top: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #cartContainer, #historyContainer {
            display: none;
        }

        #infoBox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 10px;
            display: none;
        }

        .nav-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            text-align: left;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .nav-btn:hover {
            background-color: #777;
        }

        .menu-item img, .cart-item img, .order-item img {
            max-width: 80px;
            max-height: 60px;
            margin-right: 10px;
        }

        #totalAmount {
            font-weight: bold;
        }

        
    </style>
</head>
<body>
    
    <div id="sidebar">
        <h2 style="color: #af4e4c;">餐厅点餐系统</h2>
        <button class="nav-btn" onclick="showMenu()">菜单</button>
        <button class="nav-btn" onclick="showCart()">购物车</button>
        <button class="nav-btn" onclick="showHistory()">历史订单</button>
        <button class="nav-btn checkout-btn" onclick="checkout()">结账</button>
        <button class="nav-btn" onclick="showAddItemPage()">添加菜品</button> <!-- 新添加的按钮 -->
    </div>

    <div id="content">
        <!-- <h1>餐厅点餐系统</h1> -->
        <div>

        <div id="menu">
            <!-- 菜单项将通过 JavaScript 动态生成 -->
        </div>

        <div id="cartContainer">
            <h2>购物车</h2>
            <div id="cart">
                <!-- 购物车内容将通过 JavaScript 动态生成 -->
            </div>

            <p id="totalAmount">总金额：￥0.00</p>
            <button class="checkout-btn" onclick="checkout()">结账</button>
        </div>

        <div id="historyContainer">
            <h2>历史订单</h2>
            <!-- 历史订单内容将通过 JavaScript 动态生成 -->
        </div>
    </div>
    <div id="infoBox">已加入购物车</div>

    <script>
        var menuItems = [
            { "id": 1, "name": "火锅底料", "price": 50.0, "image": "./img/火锅底料.jpg" },
            { "id": 4, "name": "糖醋里脊", "price": 88.0, "image": "https://img95.699pic.com/photo/60005/9943.jpg_wh300.jpg" },
            { "id": 2, "name": "海虾", "price": 48.0, "image": "./img/海虾.jpg" },
            { "id": 3, "name": "麻婆豆腐", "price": 20.0, "image": "./img/麻婆豆腐.jpg" },
            { "id": 4, "name": "梅菜扣肉", "price": 66.0, "image": "./img/梅菜扣肉.jpg" },
            { "id": 5, "name": "木耳", "price": 18.0, "image": "./img/木耳.jpg" },
            { "id": 6, "name": "拍黄瓜", "price": 18.0, "image": "./img/拍黄瓜.jpg" },
            { "id": 7, "name": "肉卷", "price": 30.0, "image": "./img/肉卷.jpg" },
            { "id": 8, "name": "酸菜鱼", "price": 99.0, "image": "./img/酸菜鱼.jpg" },
            // 添加更多菜品...
        ];

        var cart = [];
        var orderHistory = [];

        function renderMenuAndCart() {
            var menuHtml = "";
            var cartHtml = "";

            menuItems.forEach(function (item) {
                menuHtml += '<div class="menu-item">' +
                    '<img src="' + item.image + '" alt="' + item.name + '">' +
                    '<span>' + item.name + ' - ￥' + item.price.toFixed(2) + '</span>' +
                    '<button onclick="addToCart(' + item.id + ')">加入购物车</button>' +
                    '</div>';
            });

            cart.forEach(function (item) {
                cartHtml += '<div class="cart-item">' +
                    '<img src="' + item.image + '" alt="' + item.name + '">' +
                    '<span>' + item.name + ' - ￥' + item.price.toFixed(2) + '</span>' +
                    '<button onclick="removeFromCart(' + item.id + ')">移出购物车</button>' +
                    '</div>';
            });

            var totalAmount = cart.reduce(function (acc, item) {
                return acc + item.price;
            }, 0);

            document.getElementById('menu').innerHTML = menuHtml;
            document.getElementById('cart').innerHTML = cartHtml;
            document.getElementById('totalAmount').innerText = '总金额：￥' + totalAmount.toFixed(2);
        }

        function addToCart(itemId) {
            var item = menuItems.find(function (x) { return x.id === itemId; });
            if (item) {
                cart.push(item);
                renderMenuAndCart();
                showInfoBox(item.name); // 显示信息提示框，并传入菜品名字
            }
        }

        function removeFromCart(itemId) {
            var index = cart.findIndex(function (x) { return x.id === itemId; });
            if (index !== -1) {
                cart.splice(index, 1);
                renderMenuAndCart();
            }
        }

        function checkout() {
    if (cart.length === 0) {
        alert('请先选择菜品再结账！');
        return; // 阻止执行下面的结账逻辑
    }

    var orderSummary = "您的订单包含:\n";
    cart.forEach(function (item) {
        orderSummary += item.name + ' - ￥' + item.price.toFixed(2) + '\n';
    });

    var totalAmount = cart.reduce(function (acc, item) {
        return acc + item.price;
    }, 0);

    orderSummary += "\n总金额：￥" + totalAmount.toFixed(2) + "\n是否确认下单？";

    var orderNumber = generateOrderNumber();
    orderSummary += "\n订单号：" + orderNumber;

    if (confirm(orderSummary)) {
        alert('订单结算成功！');
        orderHistory.push({ orderNumber: orderNumber, items: cart, totalAmount: totalAmount });
        cart = [];
        renderMenuAndCart();
        toggleCart(); // 结账后隐藏购物车
    }
}


        function showMenu() {
            document.getElementById('menu').style.display = 'block';
            document.getElementById('cartContainer').style.display = 'none';
            document.getElementById('historyContainer').style.display = 'none';
        }

        function showCart() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('cartContainer').style.display = 'block';
            document.getElementById('historyContainer').style.display = 'none';
        }

        function showHistory() {
            renderOrderHistory();
            document.getElementById('menu').style.display = 'none';
            document.getElementById('cartContainer').style.display = 'none';
            document.getElementById('historyContainer').style.display = 'block';
        }

        function showInfoBox(itemName) {
            var infoBox = document.getElementById('infoBox');
            infoBox.innerText = '已加入购物车：' + itemName;
            infoBox.style.display = 'block';

            // 隐藏信息提示框，延迟1.5秒钟
            setTimeout(function() {
                infoBox.style.display = 'none';
            }, 1500);
        }

        function generateOrderNumber() {
            var now = new Date();
            var year = now.getFullYear();
            var month = now.getMonth() + 1;
            var day = now.getDate();
            var hours = now.getHours();
            var minutes = now.getMinutes();
            var seconds = now.getSeconds();

            return '' + year + padNumber(month) + padNumber(day) + padNumber(hours) + padNumber(minutes) + padNumber(seconds);
        }

        function padNumber(num) {
            return num < 10 ? '0' + num : '' + num;
        }

        function renderOrderHistory() {
            var historyHtml = "";
            orderHistory.forEach(function (order) {
                historyHtml += '<div class="order-item">';
                historyHtml += '<h3>订单号 #' + order.orderNumber + '</h3>';
                order.items.forEach(function (item) {
                    historyHtml += '<div>' +
                        '<img src="' + item.image + '" alt="' + item.name + '">' +
                        '<span>' + item.name + ' - ￥' + item.price.toFixed(2) + '</span>' +
                        '</div>';
                });
                historyHtml += '<p>总金额：￥' + order.totalAmount.toFixed(2) + '</p>';
                historyHtml += '</div>';
            });
            document.getElementById('historyContainer').innerHTML = historyHtml;
        }

        renderMenuAndCart();

        function showAddItemPage() {
    window.location.href = 'add_item.html';
}

// 在点餐系统的脚本中添加以下代码
window.addEventListener('message', function (event) {
    if (event.data.type === 'addMenuItem') {
        var newItem = event.data.data;

        // 在这里将新菜品添加到点餐系统的菜单中
        // 例如，可以将 newItem 添加到 menuItems 数组中
        menuItems.push(newItem);

        // 调用相应的渲染函数来更新菜单显示
        renderMenuAndCart();
    }
});

window.addEventListener('message', function (event) {
    if (event.data.type === 'addMenuItem') {
        var newItem = event.data.data;

        // 在这里将新菜品添加到点餐系统的菜单中
        // 例如，可以将 newItem 添加到 menuItems 数组中
        menuItems.push(newItem);

        // 调用相应的渲染函数来更新菜单显示
        renderMenuAndCart();
    }
});

// 在已有的 JavaScript 代码后添加以下内容

// 搜索功能
function searchMenu() {
    var searchTerm = document.getElementById('searchInput').value.toLowerCase();

    // 使用 filter 方法过滤菜单项
    var searchResults = menuItems.filter(function (item) {
        return item.name.toLowerCase().includes(searchTerm);
    });

    // 渲染搜索结果
    renderSearchResults(searchResults);
}

// 渲染搜索结果
function renderSearchResults(results) {
    var resultsHtml = "";

    results.forEach(function (item) {
        resultsHtml += '<div class="menu-item">' +
            '<img src="' + item.image + '" alt="' + item.name + '">' +
            '<span>' + item.name + ' - ￥' + item.price.toFixed(2) + '</span>' +
            '<button onclick="addToCart(' + item.id + ')">加入购物车</button>' +
            '</div>';
    });

    // 将搜索结果显示在页面上
    document.getElementById('searchResults').innerHTML = resultsHtml;
}

// 在页面加载时调用 renderMenuAndCart，确保初始状态显示全部菜品
renderMenuAndCart();

    </script>
</body>
</html>
